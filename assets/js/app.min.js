$(document).ready(function(){function a(){$(".preload").stop().velocity({opacity:"0"},{duration:800,complete:function(){$(this).hide()}}),$("body").removeClass("preload-body")}function v(){c[$(".active").index()].focus()}function w(a){var b=a.children().length;b=40*b+"px",a.is(":visible")?a.stop().animate({height:"0px"},200,function(){$(this).hide()}):a.show().stop().animate({height:b},200)}function x(){var d,e,a=$(".CodeMirror").css("font-family"),b=$(".CodeMirror").css("font-size"),c=$(".selector-library").clone().children().remove().end().text();d=!!$(".linter-checkbox").hasClass("active-checkbox"),e=!!$(".activeline-checkbox").hasClass("active-checkbox"),k={theme:u.theme,font:a,fontSize:b,tabSize:u.tabSize,softWrap:u.lineWrapping,library:c,lint:d,styleActiveLine:e},chrome.storage.local.set({settings:k})}function y(){for(var a=0;a<c.length;a++)c[a].refresh()}function z(a,b){var c=a.split(","),d=b<0?0:255,e=b<0?b*-1:b,f=parseInt(c[0].slice(4)),g=parseInt(c[1]),h=parseInt(c[2]);return"rgb("+(Math.round((d-f)*e)+f)+","+(Math.round((d-g)*e)+g)+","+(Math.round((d-h)*e)+h)+")"}function A(a){$(".sidebar").css("background-color",z(a,-.2)),$(".workspace, body").css("background-color",a),$(".windowBar").css("background-color",z(a,.1)),$(".settings-container").css("background-color",z(a,-.1))}function B(a){$(".CodeMirror").css("font-family",a.font),$(".CodeMirror").css("font-size",a.fontSize),E("theme",a.theme),E("tabSize",a.tabSize),E("lineWrapping",a.softWrap),E("lint",a.lint),E("styleActiveLine",a.styleActiveLine),$(".active").attr("class","tab active active-"+a.theme);var b=$(".CodeMirror").css("background-color");A(b),u.theme=a.theme,u.tabSize=a.tabSize,u.indentUnit=a.tabSize,u.lineWrapping=a.softWrap,u.lint=a.lint,u.styleActiveLine=a.styleActiveLine,G(b),y()}function C(a){$(".selector-theme").html(a.theme.replace(/-/g," ")+'<div class="material-icons">arrow_drop_down</div>'),$(".selector-font").html(a.font.replace(/"/g,"").toLowerCase()+'<div class="material-icons">arrow_drop_down</div>'),$(".selector-font-size").html(a.fontSize+'<div class="material-icons">arrow_drop_down</div>'),$(".selector-tab-size").html(a.tabSize+'<div class="material-icons">arrow_drop_down</div>'),a.softWrap===!0?$(".selector-wrap").html('wrap<div class="material-icons">arrow_drop_down</div>'):$(".selector-wrap").html('none<div class="material-icons">arrow_drop_down</div>'),void 0===a.library&&(a.library="jquery.min.js"),$(".selector-library").html(a.library+'<div class="material-icons">arrow_drop_down</div>'),a.styleActiveLine===!1||($(".activeline-checkbox").addClass("active-checkbox"),$(".activeline-checkbox").find(".material-icons").text("check")),a.lint===!1||($(".linter-checkbox").addClass("active-checkbox"),$(".linter-checkbox").find(".material-icons").text("check"))}function D(){chrome.storage.local.get({settings:"prefs"},function(a){var b=a.settings;"prefs"==b||void 0===b||null===b?(kb(),B(k),C(k)):(k=b,B(b),C(b))})}function E(a,b){for(var d=0;d<c.length;d++)c[d].setOption(a,b)}function F(a,b){a.html(b+'<div class="material-icons">arrow_drop_down</div>')}function G(a){$(".tabs, .overflow-menu").css("background-color",a)}function H(a){return ca?"string"==typeof a?a.replace(ca.fullPath,""):a.fullPath.replace(ca.fullPath,""):"string"==typeof a?a:a.fullPath}function I(a,b){$.get(a,function(a){var c;c=Ba?"keyboard_arrow_down"==Ba.find(".material-icons").first().text()||"book"==Ba.find(".material-icons").eq(1).text()?Ba:Ba.parent().parent():$(".projects").children().first();var d=c.find(".folder-name").first().text(),e=c.attr("path"),f=function(a){var b=H(a.entry);if(a.entry.name==d&&b==e)return a},g=i.find(f);g=g.entry,g.getFile(b,{create:!0,exclusive:!0},function(b){b.createWriter(function(b){var c=new Blob([a]);b.write(c)}),h.push({entry:b});var d=b.name;d=fa(d),d=d.replace(/\./g,"");var e=H(b),f=document.createElement("div"),g=Qa(b.name,!0);f.className=d+" file",f.setAttribute("path",e),f.innerHTML=g+'<label class="file-name">'+b.name+"</label>",c.children().last().append(f),oa(c.children().last().children().last()),x()})})}function J(){$(".dropdown").hide(),$(".settings-container").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200),$(".settingdiv span").hide()}function K(){$(".settings-container").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function L(a){c[a].on("change",function(){$(".active .close").text("fiber_manual_record"),$(".active .close").addClass("edit")});var b=c[a].defaultCharWidth(),d=4;c[a].on("renderLine",function(a,c,e){var f=CodeMirror.countColumn(c.text,null,a.getOption("tabSize"))*b;e.style.textIndent="-"+f+"px",e.style.paddingLeft=d+f+"px"})}function M(){l=[];for(var a=0;a<$(".tab").length;a++){var b=$(".tab").eq(a).attr("id").replace("tab","");l.push(Number(b))}}function N(){var a;0===$(".tab").length?a=0:(M(),a=Math.max.apply(null,l)+1),$(".tab").removeClass("active"),$(".tab").removeClass("active-"+u.theme),$(".tabs").append('<div id="tab'+a+'"class="tab active active-'+u.theme+'"><input class="title"/><span class="close material-icons">close</span></div>'),Ya("untitled.txt"),$(".workspace").append('<textarea id="textarea'+a+'"></textarea>'),$(".active").attr("id","tab"+a),$(".CodeMirror").hide(),db(),$("#textarea"+a).show(),$a(""),d[a]=""}function O(a){i.push({entry:a}),ia(i.length-1),ma(a),v()}function P(){N();var a=$(".active").index();c[a]=CodeMirror.fromTextArea(document.getElementById("textarea"+a),u),Ya("untitled.txt"),d[a]="",setTimeout(function(){$(".active").click(),L(a)})}function R(a){Y();var b=$(".active .title").val();$(".dialogue .dialogue-text").text(b+" has been modified. Unless saved, progress will be lost. Save changes?"),$(".dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200),n=a}function S(){$(".dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function U(a,b){var e=a.parent(),f=e.attr("id"),g=f.replace("tab","textarea"),h=e.attr("class"),i=e.index(),j=$(".tabs").children().last().index(),l=$(".tab").length;$("#"+g).remove(),$(".CodeMirror:eq("+e.index()+")").remove(),c.splice(i,1),d.splice(i,1),a.parent().remove(),void 0===k&&kb(),b||(0===i&&1==l?(P(),B(k)):h.indexOf("active")==-1?$(".active").click():0===i?$(".tab").eq(0).click():i==j?$(".tab").eq(i-1).click():$(".tab").eq(i).click(),db(),S())}function V(){""===window.getSelection()?$(".search-bar").select():$(".search-bar").val(window.getSelection()),chrome.app.window.current().isFullscreen()?$(".workspace").css("height","calc(100% - 150px)"):$(".workspace").css("height","calc(100% - 180px)"),$(".search-container").show().stop().animate({opacity:"1",bottom:"0px"},200),setTimeout(function(){$(".search-bar").focus()},200)}function W(){$(".workspace").css("height","calc(100% - 80px)"),$(".search-container").show().stop().animate({opacity:"0",bottom:"-100px"},200,function(){$(this).hide(),s=c[$(".active").index()],clearSearch(s),v()})}function X(){var a=60*$(".menu").children().length+"px";$(".menu").show().stop().animate({opacity:"1",height:a},200)}function Y(){$(".menu").stop().animate({opacity:"0",height:"0px"},200,function(){$(this).hide()})}function Z(a){$(".active").attr("path",a)}function _(a,b){a.forEach(function(a){a.file(function(e){var f=new FileReader;f.onload=function(e){var f=e.target.result;N(),Ya(a.name);var g=H(a);b===!1?(Z(g),$a(a.name)):($a(a.name+"isOpen"),Z(g)),$(".active input").attr("readonly",!0);var h=$(".active").attr("id").replace("tab",""),i=Number(h),j=$(".active").index();d[j]=a,c[j]=CodeMirror.fromTextArea(document.getElementById("textarea"+i),u),c[j].getDoc().setValue(f),c[j].getDoc().clearHistory(),c[j].focus(),L(j),cb(),void 0===k&&kb(),B(k)},f.readAsText(e)})})}function aa(){$(".new-project-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function ba(){$(".new-project-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function da(a){a.fullPath?($(".chosenDir").text(a.fullPath),ca=a):($(".chosenDir").text("No Directory Chosen"),ca=null)}function ea(){$(".projects div").each(function(){$(this).hasClass("file")&&$(this).insertAfter($(this).parent().children().last())})}function fa(a){return a=btoa(unescape(encodeURIComponent(a))),a.replace(/\./g,"").replace(/ /g,"_").replace(/["'()]/g,"_").replace(/[^\w\s]/gi,"").replace(/[\W\s]/gi,"").replace(/0/g,"a").replace(/1/g,"b").replace(/2/g,"c").replace(/3/g,"d").replace(/4/g,"e").replace(/5/g,"f").replace(/6/g,"g").replace(/7/g,"h").replace(/9/g,"i")}function ga(a,b,c){return a=a.split(b),0===c?a:a[a.length-c]}function ha(a){return 2==a.split("/").length}function ia(a){var b=i[a].entry.name,c=i[a].entry.fullPath;c=H(i[a].entry);var d=i[a].entry.fullPath;d=H(i[a].entry),c=ga(c,"/",0),c.forEach(function(a,b,d){c[b]=fa(a)}),b=fa(b);var f,e=document.createElement("div");e.className=b+" folder",e.setAttribute("path",d),f=ha(d)?'<div class="material-icons">book</div>':'<div class="material-icons">folder</div>',e.innerHTML='<div class="material-icons">keyboard_arrow_right</div>'+f+'<label class="folder-name">'+i[a].entry.name+'</label><ul style="display:none;" class="'+b+'ul"></ul>',c.shift(),c.forEach(function(a,b,d){c[b]=a+" > ."+a+"ul/"}),c="."+c.join(" > ."),c=c.split("/"),c.pop(),c.forEach(function(a,b,c){if(1==c.length)p.appendChild(e);else if(0===b);else{var d=c.slice(0),f=d.length-b;d.splice(b,f),d=d.join(" "),null===p.querySelector(d)||p.querySelector(d).appendChild(e)}})}function ja(a){var b=h[a].entry.name,c=h[a].entry.fullPath;c=H(h[a].entry);var d=h[a].entry.fullPath;d=H(h[a].entry),c=ga(c,"/",0),c.forEach(function(a,b,d){c[b]=fa(a)}),b=fa(b);var e=document.createElement("div"),f=Qa(h[a].entry.name,!0);e.className=b+" file",e.setAttribute("path",d),e.innerHTML=f+'<label class="file-name">'+h[a].entry.name+"</label>",c.shift(),c.forEach(function(a,b,d){b===d.length-1?c[b]=a:c[b]=a+" > ."+a+"ul"}),c.pop(),c="."+c.join(" > ."),p.querySelector(c).appendChild(e)}function ka(a,b,c){$(".loading-text").text("Loading "+a),$(".preload").css("top","100%"),$(".preload").show().stop().animate({top:"0",opacity:"1"},500),b&&b(c)}function la(){$(".preload").stop().animate({opacity:"0",top:"100%"},600,function(){$(this).hide()})}function ma(a){var b=a.createReader(),c=function(){b.readEntries(function(a){for(var b=0;b<a.length;b++){var c=a[b];c.isDirectory?(i.push({entry:c}),ia(i.length-1),ma(c)):(h.push({entry:c}),ja(h.length-1))}})};c()}function na(a){p.innerHTML="",a.getMetadata(function(b){var c=b.size,d=Math.ceil(c);Number.isFinite(d)===!1&&(d=1e3),d>2e4&&(d=2e4),d<5e3&&(d=2500),O(a),setTimeout(function(){$(".projects").append(p.children),ea(),la()},d)})}function oa(a){var d,b=a.find(".material-icons").first(),c=a.parentsUntil(".projects").length;d=a.hasClass("file")?20*(c/2)+43+"px":20*(c/2)+20+"px",b.css("padding-left",d)}function pa(a,b,c,e,f,g){var j,k=function(c){var d=H(c.entry);if(c.entry.name==a&&b==d)return c},l=function(c){var d=H(c);if(c.name==a&&b==d)return c};return c&&(j=h.find(k)),e&&(j=i.find(k)),g&&(j=d.find(l)),f?j:j.entry}function ra(a){var b=a.pageY,c=a.pageX,d=$(".contextmenu").height();b+d>$(window).height()&&(b-=d),$(".contextmenu").css({top:b-20+"px",left:c-20+"px"}).show().stop().animate({top:b+"px",opacity:"1"},200)}function sa(){$(".contextmenu").stop().animate({top:Number($(".contextmenu").css("top").replace("px",""))-20+"px",opacity:"0"},200,function(){$(this).hide()})}function ta(a){var b=a.pageY,c=a.pageX,d=$(".folder-contextmenu").height();b+d>$(window).height()&&(b-=d),$(".folder-contextmenu").css({top:b-20+"px",left:c-20+"px"}).show().stop().animate({top:b+"px",opacity:"1"},200)}function ua(){$(".folder-contextmenu").stop().animate({top:Number($(".folder-contextmenu").css("top").replace("px",""))-20+"px",opacity:"0"},200,function(){$(this).hide()})}function Da(){$(".remove-dialogue .remove-dialogue-text").text("Are you sure you want to remove "+ya+"? This action cannot be undone."),$(".remove-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Ea(){$(".remove-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Fa(){$(".folder-remove-dialogue .folder-remove-dialogue-text").text("Are you sure you want to remove "+Ca+"? This will PERMANENTLY delete this folder from your computer."),$(".folder-remove-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Ga(){$(".folder-remove-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Ha(){$(".new-file-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Ia(){$(".new-file-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Ja(){$(".new-folder-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Ka(){$(".new-folder-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function La(){$(".rename-file-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Ma(){$(".rename-file-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Na(){$(".rename-folder-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Oa(){$(".rename-folder-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Pa(a,b){$(a).css("box-shadow","inset 0px -1px 0px 0px #47bfa1"),$(a).val(b),""!==b?$(a).select():$(a).focus()}function Qa(a,b){var i,c=[".mp4",".flv",".wmv",".avi",".3gp",".m4v",".vob",".webm",".qtff",".avchd",".mov",".qt",".swf",".mkv"],d=[".png",".jpg",".jpeg",".tiff",".gif",".exiff"],e=[".wav",".mp3",".aiff",".wma",".m3u",".au",".ogg"],f=[".woff",".ttf",".woff2",".eot",".otf",".svg"],g=[".asp",".aspx",".axd",".asx",".asmx",".ashx",".css",".cfm",".yaws",".swf",".jsp",".jspx",".wss",".do",".action",".js",".json",".pl",".php",".php4",".php3",".phtml",".py",".rb",".rhtml",".shtml",".xml",".rss",".svg",".cgi",".dll"],h=[".md",".html",".htm",".xhtml",".jhtml"],j=ga(a,".",1);return j="."+j.toLowerCase(),i=b===!0?d.indexOf(j)>-1?'<div class="material-icons">photo</div>':e.indexOf(j)>-1?'<div class="material-icons">volume_up</div>':f.indexOf(j)>-1?'<div class="material-icons">text_format</div>':c.indexOf(j)>-1?'<div class="material-icons">movie</div>':g.indexOf(j)>-1?'<div class="material-icons">code</div>':h.indexOf(j)>-1?'<div class="material-icons">description</div>':'<div class="material-icons">insert_drive_file</div>':d.indexOf(j)>-1?"photo":e.indexOf(j)>-1?"volume_up":f.indexOf(j)>-1?"text_format":c.indexOf(j)>-1?"movie":g.indexOf(j)>-1?"code":h.indexOf(j)>-1?"description":"insert_drive_file"}function Ra(a){var b=jQuery.grep(i,function(b){return b.entry.fullPath.indexOf(a.fullPath)>-1}),c=jQuery.grep(h,function(b){return b.entry.fullPath.indexOf(a.fullPath)>-1});if(0!==b.length)for(var d=0;d<b.length;d++)i.splice(i.indexOf(b[d]),1);if(0!==c.length)for(var e=0;e<c.length;e++)h.splice(h.indexOf(c[e]),1)}function Sa(a,b){var c=a.createReader(),d=function(){c.readEntries(function(a){a.length||b();for(var c=0;c<a.length;c++){var e=a[c];e.isDirectory?(i.push({entry:e}),Sa(e,b)):h.push({entry:e})}d()})};d()}function Ta(a,b,c){$(a+" div:not(.material-icons)").each(function(a){var e=$(this).attr("path");if($(this).attr("path",e.replace("/"+b+"/","/"+c+"/")),$(this).hasClass("file")){var f=$(this).find(".file-name").first().text();if(Xa(f,e)){$(".tab").eq(Wa).attr("path",e.replace("/"+b+"/","/"+c+"/"));var g=$(".tab").eq(Wa).attr("path"),h=pa(f,g,!0,!1);d[Wa]=h}}})}function Ua(a,b,c,e,f,g){a.getFile(b,{},function(b){b.moveTo(a,c,function(a){var b=fa(a.name),h=Qa(a.name,!1),i=H(a);f.hasClass("active-file")?f.attr("class",b+" file active-file"):f.attr("class",b+" file"),f.attr("path",i),f.find(".material-icons").text(h),f.find(".file-name").first().text(a.name),e.entry=a,g&&(Va(Wa,c,i),d[Wa]=a,cb())},function(a){console.log(a)})},function(a){console.log(a)})}function Va(a,b,c){$(".tab").eq(a).find(".title").val(b),$(".tab").eq(a).attr("path",c),$(".tab").eq(a).attr("data",b+"isOpen")}function Xa(a,b){b=H(b);for(var c=0;c<$(".tab").length;c++)if($(".tab").eq(c).attr("path")==b&&$(".tab").eq(c).find(".title").val()==a)return Wa=c,!0}function Ya(a){$(".active .title").val(a)}function Za(){return $(".active .title").val()}function $a(a){$(".active").attr("data",a)}function _a(a){a?chrome.fileSystem.getWritableEntry(a,function(a){a.createWriter(function(b){var e=c[$(".active").index()].getDoc().getValue(),f=new Blob([e]),g=!1;b.onwriteend=function(a){if(!g)return g=!0,void this.truncate(f.size)},b.write(f);var h=a.name;Ya(h),$(".active input").attr("readonly",!0),d[$(".active").index()]=a,void 0!==$(".active").attr("data")&&$(".active").attr("data")!==!1&&""!==$(".active").attr("data")||$a(h),$(".active .close").text("close"),$(".active .close").removeClass("edit"),$(".active").click(),T===!0&&(U(n),T=!1)})}):console.log("User cancelled saving.")}function ab(){var a=Za();chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,acceptsAllTypes:!0},_a)}function cb(){var b,d,e,a=Za();if(b=/.+\.([^.]+)$/.exec(a)){var f=CodeMirror.findModeByExtension(b[1]);f&&(d=f.mode,e=f.mime)}else if(/\//.test(a)){var f=CodeMirror.findModeByMIME(a);f&&(d=f.mode,e=a)}else d=e=a;d&&(c[$(".active").index()].setOption("mode",e),CodeMirror.autoLoadMode(c[$(".active").index()],d))}function db(){var a=$(".tabs").width(),b=$(".tab").length,c=a/b;c>200&&(c=200),$(".tab").css({width:c+"px"})}function eb(){$(".windowBar").stop().animate({marginTop:"-30px"},200,function(){$(this).hide()}),$(".tabs, .sidebar, .overflow-menu").css({marginTop:"0"}),$(".menu").css("margin-top","15px"),$(".sidebar").css("height","100%"),$(".search-container").is(":visible")?$(".workspace").css("height","calc(100% - 150px)"):$(".workspace").css("height","calc(100% - 50px)"),$(".workspace").css("margin-top","50px")}function fb(){$(".windowBar").show().stop().animate({marginTop:"0px"},200),$(".tabs, .sidebar, .overflow-menu").css({marginTop:"30px"}),$(".menu").css("margin-top","45px"),$(".sidebar").css("height","calc(100% - 30px)"),$(".search-container").is(":visible")?$(".workspace").css("height","calc(100% - 180px)"):$(".workspace").css("height","calc(100% - 80px)"),$(".workspace").css("margin-top","80px")}function gb(){$(".started-button").stop().animate({top:"50%",opacity:"1"},400)}function hb(a,b,c,e,f,g,h,i){chrome.storage.local.set({data:a,tabs:b,state:c,inst:e,actv:f,sideBarWidth:g,projectsize:h,projectamount:i});var k=[];d.forEach(function(a,b){if(""===a||void 0===a);else{var c=chrome.fileSystem.retainEntry(a);k.push({index:b,entry:c})}});var l;l=void 0===ca||null===ca?"":chrome.fileSystem.retainEntry(ca),chrome.storage.local.set({chosenFiles:k,chosenDirs:j,chosenDir:l})}function ib(a){f=[],e=[],g=[];for(var b=0;b<$(".tab").length;b++){var d=b,h=c[d].getValue(),i=$(".tab").eq(d).find(".material-icons").text(),k=j.length,l=d;e[d]=h,f[d]={name:$(".tab").eq(d).find(".title").val(),path:$(".tab").eq(d).attr("path"),dataAttr:$(".tab").eq(d).attr("data"),isReadOnly:$(".tab").eq(d).find("input").attr("readonly")},g[d]=i;var m=$(".active").index(),n=$(".sidebar").width();if(l===$(".tab").length-1){var p=0;if(0===j.length)hb(e,f,g,o,m,n,p,k);else for(var q=0;q<j.length;q++)chrome.fileSystem.restoreEntry(j[q],function(a){a.getMetadata(function(a){p+=Math.ceil(a.size),hb(e,f,g,o,m,n,p,k)})})}}a&&a()}function jb(a){$(".sidebar").width(a),$(".tabs").width($(window).width()-70-a),$(".workspace").width($(window).width()-a),$(".search-container").width($(window).width()-a)}function kb(){k={theme:"material",font:"monospace",fontSize:"16px",tabSize:4,softWrap:!0,library:"jquery.min.js",lint:!1,styleActiveLine:!1}}function lb(b){chrome.storage.local.get({data:"textArray",tabs:"tabArray",state:"editArray",inst:"installed",actv:"activeIndex",sideBarWidth:"sideWidth",projectsize:"projectSize",projectamount:"projectAmount"},function(b){var q,e=b.data,f=b.tabs,g=b.state,h=b.inst,i=b.actv,l=b.sideBarWidth,m=b.projectsize,n=b.projectamount,o=8*JSON.stringify(e).length/1e4;if(q=0===n?Math.ceil(o):Math.ceil(m+o)/n*n/5,Number.isFinite(q)===!1&&(q=1e3),q>15e3&&(q=15e3),q<5e3&&(q=2e3),"textArray"==e||"tabArray"==f||"editArray"==g||"activeIndex"==i||"installed"==h||"sideWidth"==l||"projectSize"==m||"projectAmount"==n)kb(),P(),B(k),jb(250),setTimeout(function(){mb(),db(),a(),setTimeout(function(){gb()},200)},1e3);else{h===!0&&$(".getting-started").remove();for(var r=0;r<e.length;r++){N(),c[r]=CodeMirror.fromTextArea(document.getElementById("textarea"+Number($(".tabs").children().last().attr("id").replace("tab",""))),u),c[r].getDoc().setValue(e[r]),c[r].getDoc().clearHistory(),L(r),$(".tab").eq(r).find(".title").val(f[r].name),$(".tab").eq(r).find(".title").attr("readonly",f[r].isReadOnly),$(".tab").eq(r).attr("data",f[r].dataAttr),$(".tab").eq(r).attr("path",f[r].path),""===$(".tab").eq(r).attr("data")&&(d[r]=""),"fiber_manual_record"==g[r]&&$(".tab").eq(r).find(".material-icons").addClass("edit"),$(".tab").eq(r).find(".material-icons").text(g[r]);var s=e.length-1;s===r&&(chrome.storage.local.get({chosenFiles:"key",chosenDirs:"rootDirs",chosenDir:"newProjectDir"},function(a){var b=a.chosenFiles,c=a.chosenDirs,e=a.chosenDir;"key"!=b&&b.forEach(function(a,b,c){chrome.fileSystem.isRestorable(a.entry,function(b){chrome.fileSystem.restoreEntry(a.entry,function(b){d[a.index]=b})})}),"newProjectDir"!=e&&""!==e&&chrome.fileSystem.isRestorable(e,function(a){chrome.fileSystem.restoreEntry(e,function(a){da(a)})}),"rootDirs"!=c&&(p=document.createDocumentFragment(),c.forEach(function(a,b,c){chrome.fileSystem.isRestorable(a,function(b){chrome.fileSystem.restoreEntry(a,function(a){j.push(chrome.fileSystem.retainEntry(a)),O(a)})})}))}),jb(l),setTimeout(function(){mb(),$(".projects").append(p.children),ea(),$(".tab").eq(i).click(),D(),db(),y(),v(),a()},q))}}})}function mb(){if(launchData&&launchData.items)for(var a=0;a<launchData.items.length;a++){var b=[];b.push(launchData.items[a].entry),_(b,!1)}}function nb(){chrome.app.window.current().close()}var b=["Please wait...a few bits tried to escape, but we caught them","Please wait...and dream of faster computers","Please wait...would you like fries with that?","Please wait...checking the gravitational constant in your locale","Please wait...go ahead -- hold your breath","Please wait...at least you're not on hold","Please wait...hum something loud while others stare","Please wait...you're not in Kansas any more","Please wait...the server is powered by a lemon and two electrodes","Please wait...we love you just the way you are","Please wait...while a larger software vendor in Seattle takes over the world","Please wait...we're testing your patience","Please wait...as if you had any other choice","Please wait...take a moment to sign up for our lovely prizes","Please wait...don't think of purple hippos","Please wait...follow the white rabbit","Please wait...why don't you order a sandwich?","Please wait...programming the flux capacitor","Please wait...the bits are breeding"];$(".loading-text").text(b[Math.round(Math.random()*(b.length-1))]),$(".windowBar").initializeWindowBar("#000000"),lb(launchData),$(".menu, .dropdown, .settings-container, .bg, .dialogue, .search-container, .contextmenu, .folder-contextmenu, .remove-dialogue, .folder-remove-dialogue, .new-file-dialogue, .new-folder-dialogue, .new-project-dialogue, .rename-folder-dialogue, .rename-file-dialogue, .settingdiv span").hide();var k,l,m,n,o,p,q,r,s,t,c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=[],u={lineNumbers:!0,lineWrapping:!0,styleActiveLine:!1,matchBrackets:!0,autoCloseTags:!0,autoCloseBrackets:!0,viewportMargin:10,historyEventDelay:400,tabSize:4,indentUnit:4,foldGutter:!0,dragDrop:!1,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lint:!1,theme:"material",mode:"text/plain"};$(document).on("click",".selector-container",function(){var a=$(this).attr("class").split(" ");a=a[a.length-1];var b=a.replace("selector-","");w($(".dropdown-"+b)),"arrow_drop_down"==$(this).find(".material-icons").text()?$(this).find(".material-icons").text("arrow_drop_up"):$(this).find(".material-icons").text("arrow_drop_down")}),$(".settings").scroll(function(){var a=$(this).scrollTop();0!==a?$(".top-title").css("box-shadow","0px 5px 9px 0px rgba(0,0,0,0.1)"):$(".top-title").css("box-shadow","none")}),$(document).on("click",".activeline-checkbox",function(){$(this).hasClass("active-checkbox")?($(this).removeClass("active-checkbox"),$(this).find(".material-icons").text(""),E("styleActiveLine",!1)):($(this).addClass("active-checkbox"),$(this).find(".material-icons").text("check"),E("styleActiveLine",!0)),x()}),$(document).on("click",".linter-checkbox",function(){$(this).hasClass("active-checkbox")?($(this).removeClass("active-checkbox"),$(this).find(".material-icons").text(""),E("lint",!1)):($(this).addClass("active-checkbox"),$(this).find(".material-icons").text("check"),E("lint",!0)),x()}),$(document).on("click",".dropdown .theme",function(){var a="theme",b=$(this).text().replace(/ /g,"-");$(".active").attr("class","tab active active-"+b),F($(".selector-theme"),$(this).text()),E(a,b),u.theme=b;var c=$(".CodeMirror").css("background-color");A(c),G(c),w($(this).parent()),x()}),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$(document).on("click",".dropdown .font-fam",function(){var a=$(this).text().capitalizeFirstLetter();F($(".selector-font"),$(this).text()),$(".CodeMirror").css("font-family",a),y(),w($(this).parent()),x()}),$(document).on("click",".dropdown .font-size",function(){var a=$(this).text();F($(".selector-font-size"),a),$(".CodeMirror").css("font-size",a),y(),w($(this).parent()),x()}),$(document).on("click",".dropdown .tab-size",function(){var a=Number($(this).text());F($(".selector-tab-size"),a),E("tabSize",a),u.tabSize=a,u.indentUnit=a,y(),w($(this).parent()),x()}),$(document).on("click",".dropdown .wrap",function(){var a=$(this).text();a="none"!=a,F($(".selector-wrap"),$(this).text()),E("lineWrapping",a),u.lineWrapping=a,y(),w($(this).parent()),x()}),$(document).on("click",".dropdown .library",function(){var b,a=$(this).text();b=Ba?"keyboard_arrow_down"==Ba.find(".material-icons").first().text()||"book"==Ba.find(".material-icons").eq(1).text()?Ba:Ba.parent().parent():$(".projects").children().first();var c=[];if(w($(this).parent()),b&&0!==$(".projects").children().length)if(b.children().last().children().each(function(){if($(this).hasClass("file")){var a=$(this).find(".file-name").first().text();c.push(a)}}),navigator.onLine)if(c.indexOf(a)>-1)$(".settingdiv span").text(a+" already exists."),$(".settingdiv span").show();else{switch(F($(".selector-library"),a),a){case"jquery.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js",a);break;case"matter.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.10.0/matter.min.js",a);break;case"p5.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.7/p5.min.js",a);break;case"angular.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js",a);break;case"backbone.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js",a);break;case"ember.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/ember.js/2.11.2/ember.min.js",a);break;case"react.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.min.js",a);break;case"react-dom.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.min.js",a);break;case"three.min.js":I("https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js",a)}$(".settingdiv span").hide()}else $(".settingdiv span").show();else $(".settingdiv span").text("No folder selected. Click on the folder you wish to add "+a+" to in the projects section."),$(".settingdiv span").show()}),$(".close-settings").click(function(){K(),v()}),$(".bg").click(function(){$(".dialogue").is(":visible")&&S(),$(".remove-dialogue").is(":visible")&&Ea(),$(".folder-remove-dialogue").is(":visible")&&Ga(),$(".new-file-dialogue").is(":visible")&&Ia(),$(".new-folder-dialogue").is(":visible")&&Ka(),$(".new-project-dialogue").is(":visible")&&ba(),$(".rename-file-dialogue").is(":visible")&&Ma(),$(".rename-folder-dialogue").is(":visible")&&Oa(),$(".settings-container").is(":visible")&&K(),v()}),$(".settings-button").click(function(){J()}),$(document).on("click",".CodeMirror",function(a){""===$(".active .title").val()&&$(".active .title").val("untitled.txt"),Y()}),Array.prototype.move=function(a,b){if(b>=this.length)for(var c=b-this.length;c--+1;)this.push(void 0);this.splice(b,0,this.splice(a,1)[0])},$(".tabs").sortable({axis:"x",distance:20,tolerance:"pointer",revert:!0,start:function(a,b){a.stopImmediatePropagation(),a.stopPropagation(),$(this).attr("data-previndex",b.item.index()),$(this).addClass("noclick")},stop:function(a,b){a.stopImmediatePropagation(),a.stopPropagation();var e=b.item.index(),f=$(this).attr("data-previndex"),g=b.item.attr("id").replace("tab",""),h=$(".workspace > textarea").eq(e).attr("id").replace("textarea","");$(this).removeAttr("data-previndex"),f>e?($("#textarea"+g).insertBefore($("#textarea"+h)),$(".CodeMirror").eq(f).insertBefore($("#textarea"+h))):($(".CodeMirror").eq(f).insertAfter($(".CodeMirror").eq(e)),$("#textarea"+g).insertBefore($(".CodeMirror").eq(e))),c.move(f,e),d.move(f,e),v()}}).disableSelection(),$(document).on("click",".tab",function(a){if(a.stopPropagation(),$(this).hasClass("noclick"))$(this).removeClass("noClick");else{var b,e,f,g,h=$(this);0===h.find(".ink").length&&h.prepend('<div class="ink"></div>'),b=h.find(".ink"),b.removeClass("animate"),b.height()||b.width()||(e=Math.max(h.width(),h.height()),b.css({height:e,width:e})),f=a.pageX-h.offset().left-b.width()/2,g=a.pageY-h.offset().top-b.height()/2,b.css({top:g+"px",left:f+"px"}).addClass("animate"),$(".tab").removeClass("active"),$(".tab").removeClass("active-"+u.theme),$(this).addClass("active"),$(this).addClass("active-"+u.theme),$(".CodeMirror").hide(),$(".CodeMirror").eq($(".active").index()).show(),cb(),m=d[$(this).index()],$(".folder").removeClass("active-folder"),$(".file").removeClass("active-file"),$('.file[path="'+$(this).attr("path")+'"]').addClass("active-file"),c[$(".active").index()].refresh(),v()}});var Q;$(document).on("mouseenter",".tab input",function(){var a=$(this),b=a.parent(),c=b.attr("path"),d=$(this).val(),e=pa(d,c,!0,!1,!1);void 0===e?(e=pa(d,c,!1,!1,!0,!0),void 0===e||chrome.fileSystem.getDisplayPath(e,function(a){c=a})):chrome.fileSystem.getDisplayPath(e,function(a){c=a}),Q=setTimeout(function(){void 0===b.attr("path")||($(".tooltip").text(c),$(".tooltip").css({top:a.offset().top+a.height()-20,left:a.offset().left,backgroundColor:z($(".active").css("box-shadow").replace(/^.*(rgba?\([^)]+\)).*$/,"$1"),.1)}),$(".tooltip").show().animate({top:Number($(".tooltip").css("top").replace("px",""))+25,opacity:"1"},200))},2e3)}),$(document).on("mouseleave",".tab",function(){
clearTimeout(Q),$(".tooltip").animate({top:Number($(".tooltip").css("top").replace("px",""))-25,opacity:"0"},200,function(){$(this).hide()})}),$(".buttons-dialogue .cancel").click(function(){S(),v()}),$(".buttons-dialogue .no").click(function(){U(n),S()});var T;$(".buttons-dialogue .yes").click(function(){T=!0,$(".save").click(),S()}),$(document).on("click",".close",function(a){a.stopImmediatePropagation(),a.stopPropagation(),"fiber_manual_record"==$(this).text()?R($(this)):U($(this))}),$(document).on("change",".title",function(a){cb()}),$(document).on("keyup",".title",function(a){13==a.keyCode&&(""===$(this).val()&&$(this).val("untitled.txt"),v())}),$(document).on("keydown",".title",function(a){65==a.keyCode&&a.ctrlKey&&a.target.select(),9==a.keyCode&&""===$(this).val()&&$(this).val("untitled.txt")}),$(".search-bar").keyup(function(){$(this).css("box-shadow","inset 0px -1px 0px 0px rgba(0, 0, 0, 0.2)")}),$(".find_next").click(function(){q=$(".search-bar").val(),s=c[$(".active").index()],t=getSearchState(s),startSearch(s,t,q),doSearch(s,!1)}),$(".find_prev").click(function(){q=$(".search-bar").val(),s=c[$(".active").index()],t=getSearchState(s),startSearch(s,t,q),doSearch(s,!0)}),$(".replace_all").click(function(){q=$(".search-bar").val(),r=$(".search-replace").val(),s=c[$(".active").index()],replaceAll(s,q,r)}),$(".replace").click(function(){r=$(".search-bar").val(),q=$(".search-replace").val(),s=c[$(".active").index()];var a=getSearchCursor(s,r,s.getCursor("from")),b=function(){var c,b=a.from();if((c=a.findNext())||(a=getSearchCursor(s,r),(c=a.findNext())&&(!b||a.from().line!=b.line||a.from().ch!=b.ch))){s.setSelection(a.from(),a.to()),s.scrollIntoView({from:a.from(),to:a.to()});var d=function(b){a.replace("string"==typeof r?q:q.replace(/\$(\d)/g,function(a,c){return b[c]}))};d(c)}};b()}),$(document).bind("keydown",function(a){(a.ctrlKey&&83==a.keyCode&&!a.shiftKey||a.metaKey&&83==a.keyCode&&!a.shiftKey)&&$(".save").click(),(a.ctrlKey&&a.shiftKey&&83==a.keyCode||a.metaKey&&a.shiftKey&&83==a.keyCode)&&$(".save-as").click(),(a.ctrlKey&&78==a.keyCode||a.metaKey&&78==a.keyCode)&&(a.preventDefault(),$(".new").click()),(a.ctrlKey&&79==a.keyCode||a.metaKey&&79==a.keyCode)&&$(".open").click(),(a.ctrlKey&&80==a.keyCode||a.metaKey&&80==a.keyCode)&&($(".settings-container").is(":visible")?K():J()),(a.ctrlKey&&70==a.keyCode||a.metaKey&&70==a.keyCode)&&($(".search-container").is(":visible")&&""===window.getSelection()?W():V()),(a.ctrlKey&&87==a.keyCode||a.metaKey&&87==a.keyCode)&&(a.preventDefault(),$(".active .close").click()),27==a.keyCode&&(chrome.app.window.current().isFullscreen()?(a.preventDefault(),$(".search-container").is(":visible")&&W()):$(".search-container").is(":visible")&&W()),a.ctrlKey&&191==a.keyCode&&(a.preventDefault(),jb(0===$(".sidebar").width()?250:0),db()),a.ctrlKey&&187==a.keyCode&&(36==Number($(".CodeMirror").css("font-size").replace("px",""))||$(".font-size").eq($(".font-size:contains("+$(".CodeMirror").css("font-size")+")").index()+1).click()),a.ctrlKey&&189==a.keyCode&&(12==Number($(".CodeMirror").css("font-size").replace("px",""))||$(".font-size").eq($(".font-size:contains("+$(".CodeMirror").css("font-size")+")").index()-1).click()),a.altKey&&81==a.keyCode&&("wrap"==$(".selector-wrap").clone().children().remove().end().text()?$(".wrap:contains(none)").click():$(".wrap:contains(wrap)").click())}),$(".overflow-menu").click(function(){X()}),$(".menu-li").click(function(){Y()}),$(document).on("click",".workspace, .tab, .tabs, .sidebar",function(){Y()}),$(document).on("click",".title",function(a){a.stopImmediatePropagation(),a.stopPropagation(),"readonly"==$(this).attr("readonly")&&(a.preventDefault(),$(this).parent().click()),Y()}),$(".new").click(function(){N();var a=$(".active").index();c[a]=CodeMirror.fromTextArea(document.getElementById("textarea"+Number($(".tabs").children().last().attr("id").replace("tab",""))),u),void 0===k&&kb(),B(k),setTimeout(function(){c[a].focus(),L(a)},1)}),$(".open").click(function(){chrome.fileSystem.chooseEntry({acceptsMultiple:!0},function(a){a||console.log("No Files Selected"),_(a,!1)})}),$(".sidebar").resizable({handles:"e",maxWidth:600,resize:function(a,b){var c=b.size.width;$(".tabs").width($(window).width()-70-c),$(".workspace").width($(window).width()-c),$(".search-container").width($(window).width()-c),db()}}),$(".add-newproject").click(function(){aa(),$(".new-project-dialogue input").css("box-shadow","0px 1px 0px 0px #47bfa1"),$(".new-project-dialogue input").val(""),$(".new-project-dialogue input").focus()}),$(".new-project-cancel").click(function(){ba(),v()});var ca;$(".projects").scroll(function(){sa(),ua()}),$(".chooseDir").click(function(){chrome.fileSystem.chooseEntry({type:"openDirectory"},function(a){if(a)da(a),$(".new-project-input").focus();else{var b="No Directory Chosen";da(b)}})}),$(".new-project-create").click(function(){var a=$(this).parent().parent().find("input").val();""===a&&(a="untitled"),ca.getDirectory(a,{create:!0,exclusive:!0},function(a){a.getFile("temp.txt",{create:!0,exclusive:!0},function(a){a.getParent(function(b){j.push(chrome.fileSystem.retainEntry(b)),i.push({entry:b});var c=H(b),d=document.createElement("div"),e=b.name;e=fa(e),d.className=e+" folder",d.setAttribute("path",c),d.innerHTML='<div class="material-icons">book</div>'+b.name+'<ul class="'+e+'ul"></ul>',$(".projects").append(d),$(".projects").children().last().children().last().hide(),ba(),v(),a.remove(function(){console.log("success!")})})})})}),$(document).on("keyup",".dialog-input:not(.rename-file-input, .rename-folder-input)",function(a){var b=$(this).val();""===b&&(b="untitled");var c=[];$(this).hasClass("new-project-input")?($(".projects").children().each(function(a){c.push($(this).find(".folder-name").first().text())}),13==a.keyCode&&$(".new-project-create").click()):Ba.children().last().children().each(function(a){c.push($(this).find(".folder-name").first().text())}),c.indexOf(b)>-1?$(this).css("box-shadow","0px 1px 0px 0px #d61f1f "):$(this).css("box-shadow","0px 1px 0px 0px #47bfa1")}),p=document.createDocumentFragment(),$(".open-dir").click(function(){chrome.fileSystem.chooseEntry({type:"openDirectory"},function(a){if(a){var b;if(0===j.length)p.innerHTML="",j.push(chrome.fileSystem.retainEntry(a)),ka(a.name,na,a);else for(var c=0;c<j.length;c++)chrome.fileSystem.restoreEntry(j[c],function(c){c.fullPath==a.fullPath&&(b=!0)}),c===j.length-1&&(b===!0||(j.push(chrome.fileSystem.retainEntry(a)),ka(a.name),p.innerHTML="",a.getMetadata(function(b){var c=b.size,d=Math.ceil(c);Number.isFinite(d)===!1&&(d=1e3),d>2e4&&(d=2e4),d<5e3&&(d=2500),O(a),setTimeout(function(){$(".projects").append(p.children),ea(),la()},d)})))}else console.log("No Directory Selected")})}),$(document).on("click",".projects .folder",function(a){a.stopPropagation(),$(".file").removeClass("active-file"),$(".folder").removeClass("active-folder"),$(this).addClass("active-folder"),$(this).children("ul").is(":visible")?($(this).children("ul").hide(),$(this).children(".material-icons").first().text("keyboard_arrow_right")):($(this).children("ul").children().each(function(a){oa($(this))}),$(this).children("ul").show(),$(this).children(".material-icons").first().text("keyboard_arrow_down")),Ba=$(this)}),$(document).on("click",".projects ul",function(a){a.stopPropagation(),a.stopImmediatePropagation()});var qa;$(document).on("click",".projects .file",function(a){if(a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation(),a.handled!==!0){a.handled=!0,$(".folder").removeClass("active-folder"),$(".file").removeClass("active-file"),$(this).addClass("active-file");var b=[],c=$(this).find(".file-name").first().text(),d=$(this).attr("path"),e=pa(c,d,!0,!1);Xa(c,d)===!0?$(".tab").eq(Wa).click():(b.push(e),_(b,!0))}sa()});var va,wa,xa,ya,za,Aa,Ba,Ca;$(document).on("contextmenu",".projects .file",function(a){a.stopPropagation(),a.preventDefault(),ya=$(this).find(".file-name").first().text(),va=ya,wa=$(this).attr("path"),xa=$(this),ra(a)}),$(".folder-contextmenu .folder-rename").click(function(){Na(),sa(),Pa(".rename-folder-input",za)}),$(".rename-folder-cancel").click(function(){Oa(),v()}),$(".rename-folder-create").click(function(){var a=$(".rename-folder-input").val();""===a&&(a=za);var b=[];if(Ba.parent().children().each(function(a){var c=$(this).find(".folder-name").first().text();c==za||b.push(c)}),b.indexOf(a)>-1)$(".rename-folder-input").css("box-shadow","0px 1px 0px 0px #d61f1f"),$(".rename-folder-input").focus();else{var c=function(a){var b=H(a.entry);return a.entry.name==za&&b==Aa},d=pa(za,Aa,!1,!0),e=i.findIndex(c);d.getParent(function(b){d.moveTo(b,a,function(b){var c=b.name;c=fa(c),i[e]={entry:b};var f=H(b);Ba.attr("class",c+" folder"),Ba.attr("path",f),Ba.children().last().attr("class",c+"ul"),Ba.find(".folder-name").first().text(a),Ra(d),Sa(b,function(){Ta("."+c+"ul",d.name,b.name)}),Oa(),v()})})}}),$(".contextmenu .rename").click(function(){La(),sa(),Pa(".rename-file-input",va)}),$(".rename-file-create").click(function(){var a=$(this).parent().parent().find("input").val(),b=pa(va,wa,!0,!1);b=b.name,""===a&&(a=b);var c=[];if(xa.parent().children().each(function(a){var d=$(this).find(".file-name").first().text();d==b||c.push(d)}),c.indexOf(a)>-1)$(this).parent().parent().find("input").css("box-shadow","0px 1px 0px 0px #d61f1f "),$(".rename-file-input").focus();else{var d=ga(wa,"/",2),e=wa.split("/");e.splice(e.length-1,1),e=e.join("/");var f=pa(d,e,!1,!0),g=pa(va,wa,!0,!1,!0);Xa(va,g.entry.fullPath)===!0?Ua(f,g.entry.name,a,g,xa,!0):Ua(f,g.entry.name,a,g,xa,!1),Ma(),v()}}),$(".rename-file-cancel").click(function(){Ma(),v()}),$(".contextmenu .remove").click(function(){Da(),sa()}),$(document).on("contextmenu",".projects .folder",function(a){a.stopPropagation(),a.preventDefault(),Ca=$(this).find(".folder-name").first().text(),za=Ca,Aa=$(this).attr("path"),Ba=$(this),ta(a);var b=$(".projects").children(),c=[];b.each(function(){c.push($(this).attr("path"))}),c.indexOf(Aa)>-1?($(".folder-contextmenu .folder-rename").hide(),$(".folder-contextmenu .folder-removefromproject").show()):($(".folder-contextmenu .folder-rename").show(),$(".folder-contextmenu .folder-removefromproject").hide())}),$(document).on("keyup",".new-folder-dialogue input",function(a){a.stopPropagation(),13==a.keyCode&&$(".new-folder-create").click()}),$(document).on("keyup",".new-file-dialogue input",function(a){a.stopPropagation(),13==a.keyCode&&$(".new-file-create").click()}),$(document).on("keyup",".rename-file-input",function(a){a.stopPropagation();var b=$(this).val(),c=pa(va,wa,!0,!1).name;""===b&&(b=c);var d=[];xa.parent().children().each(function(a){var b=$(this).find(".file-name").first().text();b==c||d.push(b)}),d.indexOf(b)>-1?$(this).css("box-shadow","0px 1px 0px 0px #d61f1f "):$(this).css("box-shadow","0px 1px 0px 0px #47bfa1"),13==a.keyCode&&$(".rename-file-create").click()}),$(document).on("keyup",".rename-folder-input",function(a){a.stopPropagation();var b=$(this).val(),c=pa(za,Aa,!1,!0).name;""===b&&(b=c||"untitled");var d=[];Ba.parent().children().each(function(a){var b=$(this).find(".folder-name").first().text();b==c||d.push(b)}),d.indexOf(b)>-1?$(this).css("box-shadow","0px 1px 0px 0px #d61f1f "):$(this).css("box-shadow","0px 1px 0px 0px #47bfa1"),13==a.keyCode&&$(".rename-folder-create").click()}),$(".folder-contextmenu .folder-removefromproject").click(function(){var a=pa(za,Aa,!1,!0);Ra(a);for(var b,c=0;c<j.length;c++)chrome.fileSystem.restoreEntry(j[c],function(d){d.fullPath==a.fullPath&&(j.splice(c,1),b=!0)});b&&(Ba.velocity("slideUp",{duration:200,complete:function(){$(this).remove()}}),v())}),$(".folder-contextmenu .folder-addfolder").click(function(){Ja(),ua(),Pa(".new-folder-input","")}),$(".new-folder-create").click(function(){var a=$(this).parent().parent().find("input").val();""===a&&(a="untitled");var b=[];if(Ba.children().last().children().each(function(a){b.push($(this).find(".folder-name").first().text())}),b.indexOf(a)>-1)$(".new-folder-input").css("box-shadow","0px 1px 0px 0px #d61f1f "),$(".new-folder-input").focus();else{var c=pa(za,Aa,!1,!0);c.getDirectory(a,{create:!0,exclusive:!0},function(a){i.push({entry:a});var b=a.name;b=fa(b);var c=document.createElement("div"),d=H(a);c.className=b+" folder",c.setAttribute("path",d),c.innerHTML='<div class="material-icons">keyboard_arrow_right</div><div class="material-icons">folder</div><label class="folder-name">'+a.name+'</label><ul class="'+b+'ul"></ul>',Ba.children().last().append(c),Ba.children().last().children().last().children().last().hide(),Ba.children().last().children().last().insertBefore(Ba.children().last().children().first()),oa(Ba.children().last().children().first()),Ka()})}}),$(".new-folder-cancel").click(function(){Ka(),v()}),$(".folder-contextmenu .folder-remove").click(function(){Fa(),ua()}),$(".folder-remove-yes").click(function(){for(var a=pa(za,Aa,!1,!0),b=0;b<j.length;b++)chrome.fileSystem.restoreEntry(j[b],function(c){a.fullPath==c.fullPath&&j.splice(b,1)});$(".tab").each(function(b){void 0===$(this).attr("path")||$(this).attr("path").indexOf(a.fullPath)>-1&&U($(this).find(".close"),!0)}),a.removeRecursively(function(){1==$(".active").length||$(".tab").eq(Math.round(Math.random()*($(".tab").length-1))).click(),Ba.remove(),Ga(),v()})}),$(".folder-remove-no").click(function(){Ga(),v()}),$(".folder-addfile").click(function(){Ha(),sa(),Pa(".new-file-input","")}),$(".new-file-cancel").click(function(){Ia(),v()}),$(".new-file-create").click(function(){var a=$(this).parent().parent().find("input").val();""===a&&(a="untitled.txt");var b=[];if(Ba.children().last().children().each(function(a){b.push($(this).find(".file-name").first().text())}),b.indexOf(a)>-1)$(".new-file-input").css("box-shadow","0px 1px 0px 0px #d61f1f"),$(".new-file-input").focus();else{var c=pa(za,Aa,!1,!0);c.getFile(a,{create:!0,exclusive:!0},function(a){var b=[];b.push(a),_(b,!0),h.push({entry:a});var c=a.name;c=fa(c),c=c.replace(/\./g,""),m=a;var d=document.createElement("div"),e=Qa(a.name,!0),f=H(a);d.className=c+" file active-file",d.setAttribute("path",f),d.innerHTML=e+'<label class="file-name">'+a.name+"</label>",$(".folder").removeClass("active-folder"),$(".file").removeClass("active-file"),$(".file").css("box-shadow","none"),Ba.children().last().append(d),oa(Ba.children().last().children().last()),Ia()})}});var Wa;$(".remove-buttons .remove-yes").click(function(){qa=pa(va,wa,!0,!1),Xa(va,qa.fullPath)===!0?(U($(".tab").eq(Wa).find(".close")),qa.remove(function(){xa.remove(),Ea(),v()})):qa.remove(function(){xa.remove(),Ea(),v()})}),$(".remove-buttons .remove-no").click(function(){Ea(),v()}),$(document).on("mousedown",function(a){var b=a.target;$(b).parents().is(".contextmenu")&&$(b).parents().is(".folder-contextmenu")||(sa(),ua(),clearTimeout(Q),$(".tooltip").animate({top:Number($(".tooltip").css("top").replace("px",""))-25,opacity:"0"},200,function(){$(this).hide()}))}),$(".save").click(function(){if(m=d[$(".active").index()])_a(m);else{var a=Za();chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,acceptsAllTypes:!0},_a)}}),$(".save-as").click(function(){ab()}),$(".tidy-up").click(function(){var b,a=c[$(".active").index()].getValue();b=$(".active .title").val().indexOf(".html")>-1?html_beautify(a,{indent_size:u.tabSize}):$(".active .title").val().indexOf(".css")>-1?css_beautify(a,{indent_size:u.tabSize}):$(".active .title").val().indexOf(".js")>-1?js_beautify(a,{indent_size:u.tabSize}):js_beautify(a,{indent_size:u.tabSize}),c[$(".active").index()].setValue(b)});new DnDFileController("body",function(a){for(var b=[],c=0;c<a.items.length;c++)b.push(a.items[c].webkitGetAsEntry()),c===a.items.length-1&&_(b,!1)});$(window).resize(function(){var a=$(".sidebar").width();jb(a),db(),chrome.app.window.current().isFullscreen()?eb():fb()}),$(".started-button").click(function(){$(".getting-started").stop().animate({top:"-100%",opacity:"0"},400,function(){$(this).remove()}),o=!0,ib(),v()}),chrome.runtime.onMessage.addListener(function(a,b,c){a.open&&mb()}),$(document).delegate(".app-windowbar-close","click",function(){ib(nb)}),$(window).mouseleave(function(){ib()}),$(document).delegate(".app-windowbar-minimize","click",function(){chrome.app.window.current().minimize()}),$(document).delegate(".app-windowbar-maximize","click",function(){v(),chrome.app.window.current().isMaximized()?chrome.app.window.current().restore():chrome.app.window.current().maximize()})});