$(document).ready(function(){function u(a){var b=a.children().length;b=40*b+"px",a.is(":visible")?a.stop().animate({height:"0px"},200,function(){$(this).hide()}):a.show().stop().animate({height:b},200)}function v(){var a=$(".CodeMirror").css("font-family"),b=$(".CodeMirror").css("font-size");j={theme:t.theme,font:a,fontSize:b,tabSize:t.tabSize,softWrap:t.lineWrapping},chrome.storage.local.set({settings:j})}function w(){for(var a=0;a<b.length;a++)b[a].refresh()}function x(a,b){var c=a.split(","),d=b<0?0:255,e=b<0?b*-1:b,f=parseInt(c[0].slice(4)),g=parseInt(c[1]),h=parseInt(c[2]);return"rgb("+(Math.round((d-f)*e)+f)+","+(Math.round((d-g)*e)+g)+","+(Math.round((d-h)*e)+h)+")"}function y(a){$(".CodeMirror").css("font-family",a.font),$(".CodeMirror").css("font-size",a.fontSize),B("theme",a.theme),B("tabSize",a.tabSize),B("lineWrapping",a.softWrap),$(".active").attr("class","tab active active-"+a.theme),$(".sidebar").css("background-color",x($(".CodeMirror").css("background-color"),-.2)),$(".workspace, body").css("background-color",$(".CodeMirror").css("background-color")),$(".add-newproject").css("background-color",x($(".active").css("box-shadow").replace(/^.*(rgba?\([^)]+\)).*$/,"$1"),-.4)),t.theme=a.theme,t.tabSize=a.tabSize,t.indentUnit=a.tabSize,t.lineWrapping=a.softWrap;var b=$(".CodeMirror").css("background-color");D(b),w()}function z(a){$(".selector-theme").html(a.theme+'<div class="material-icons">arrow_drop_down</div>'),$(".selector-font").html(a.font.replace(/"/g,"").toLowerCase()+'<div class="material-icons">arrow_drop_down</div>'),$(".selector-font-size").html(a.fontSize+'<div class="material-icons">arrow_drop_down</div>'),$(".selector-tab-size").html(a.tabSize+'<div class="material-icons">arrow_drop_down</div>'),a.softWrap===!0?$(".selector-wrap").html('wrap<div class="material-icons">arrow_drop_down</div>'):$(".selector-wrap").html('none<div class="material-icons">arrow_drop_down</div>')}function A(){chrome.storage.local.get({settings:"prefs"},function(a){var b=a.settings;"prefs"==b?(j={theme:"material",font:"monospace",fontSize:"14px",tabSize:4,softWrap:!0},y(j),z(j)):(j=b,y(b),z(b))})}function B(a,c){for(var d=0;d<b.length;d++)b[d].setOption(a,c)}function C(a,b){a.html(b+'<div class="material-icons">arrow_drop_down</div>')}function D(a){$(".tabs, .overflow-menu").css("background-color",a)}function E(){$(".settings-container").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function F(a){b[a].on("change",function(){$(".active .close").text("edit"),$(".active .close").addClass("edit")})}function G(){k=[];for(var a=0;a<$(".tab").length;a++){var b=$(".tab").eq(a).attr("id").replace("tab","");k.push(Number(b))}}function H(){var a;0===$(".tab").length?a=0:(G(),a=Math.max.apply(null,k)+1),$(".tab").removeClass("active"),$(".tab").removeClass("active-"+t.theme),$(".tabs").append('<div id="tab'+a+'"class="tab active active-'+t.theme+'"><input class="title"/><span class="close material-icons">close</span></div>'),Ha("untitled.txt"),$(".workspace").append('<textarea id="textarea'+a+'"></textarea>'),$(".active").attr("id","tab"+a),$(".CodeMirror").hide(),Oa(),$("#textarea"+a).show(),Ja(""),c[a]=""}function I(a){var c=ea(a.fullPath,"/",1);h.push({name:a.name,path:a.fullPath,entry:a,parentDirectory:c}),fa(h.length-1),ja(a),b[$(".active").index()].focus()}function J(){H();var a=$(".active").index();b[a]=CodeMirror.fromTextArea(document.getElementById("textarea"+a),t),Ha("untitled.txt"),c[a]="",setTimeout(function(){$(".active").click(),F(a)})}function O(a){W();var b=$(".active .title").val();$(".dialogue .dialogue-text").text(b+" has been modified. Unless saved, progress will be lost. Save changes?"),$(".dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200),m=a}function P(){$(".dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function R(a){var d=a.parent(),e=d.attr("id"),f=e.replace("tab","textarea"),g=d.attr("class"),h=d.index(),i=$(".tabs").children().last().index(),k=$(".tab").length;$("#"+f).remove(),$(".CodeMirror:eq("+d.index()+")").remove(),b.splice(h,1),c.splice(h,1),a.parent().remove(),void 0===j&&(j={theme:"material",font:"monospace",fontSize:"14px",tabSize:4,softWrap:!0}),0===h&&1==k?(J(),y(j)):g.indexOf("active")==-1?$(".active").click():0===h?$(".tab").eq(0).click():h==i?$(".tab").eq(h-1).click():$(".tab").eq(h).click(),Oa(),P()}function S(){""==window.getSelection()?$(".search-bar").select():$(".search-bar").val(window.getSelection()),$(".workspace").css("height","calc(100% - 180px)"),$(".search-container").show().stop().animate({opacity:"1",bottom:"0px"},200),w(),setTimeout(function(){$(".search-bar").focus()},200)}function T(){$(".workspace").css("height","calc(100% - 80px)"),$(".search-container").show().stop().animate({opacity:"0",bottom:"-100px"},200,function(){$(this).hide(),r=b[$(".active").index()],clearSearch(r),b[$(".active").index()].focus()})}function V(){$(".menu").show().stop().animate({opacity:"1",height:"420px"},200)}function W(){$(".menu").stop().animate({opacity:"0",height:"0px"},200,function(){$(this).hide()})}function X(a){$(".active").attr("path",a)}function Y(a,d){a.forEach(function(a){a.file(function(e){var f=new FileReader;f.onload=function(e){var f=e.target.result;H(),Ha(a.name),d===!1?Ja(a.name):(Ja(a.name+"isOpen"),X(a.fullPath));var g=$(".active").attr("id").replace("tab",""),h=Number(g),i=$(".active").index();c[i]=a,b[i]=CodeMirror.fromTextArea(document.getElementById("textarea"+h),t),b[i].getDoc().setValue(f),b[i].getDoc().clearHistory(),b[i].focus(),F(i),Na(),void 0===j&&(j={theme:"material",font:"monospace",fontSize:"14px",tabSize:4,softWrap:!0}),y(j)},f.readAsText(e)})})}function Z(){$(".new-project-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function _(){$(".new-project-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function ba(a){a.fullPath?($(".chosenDir").text(a.fullPath),aa=a):($(".chosenDir").text("No Directory Chosen"),aa=null)}function ca(){$(".projects div").each(function(){$(this).hasClass("file")&&$(this).insertAfter($(this).parent().children().last())})}function da(a){return a.replace(/\./g,"").replace(/ /g,"_").replace(/["'()]/g,"_")}function ea(a,b,c){return a=a.split(b),0===c?a:a[a.length-c]}function fa(a){var b=h[a].name,c=h[a].path;c=ea(c,"/",0),c.forEach(function(a,b,d){c[b]=a.replace(/ /g,"_").replace(/\./g,"").replace(/["'()]/g,"_")}),b=da(b);var d=document.createElement("div");d.className=b+" folder",d.setAttribute("path",h[a].entry.fullPath),d.innerHTML='<div class="material-icons">folder</div>'+h[a].name+'<ul style="display:none;" class="'+b+'ul"></ul>',c.shift(),c.forEach(function(a,b,d){c[b]=a+" ."+a+"ul"}),c="."+c.join(" ."),null===o.querySelector(c)&&(c=c.split(" "),c.forEach(function(a,b,c){if(""===a);else{var e=c.slice();if(e.splice(b+1,c.length-(b+1)),e=e.join(" "),null!==o.querySelector(e));else{var f=c;if(0===b)o.appendChild(d);else{var g=f.length-b;f.splice(b,g),f=f.join(" "),o.querySelector(f).appendChild(d)}}}}))}function ga(a){var b=g[a].entry.name,c=g[a].entry.fullPath;c=ea(c,"/",0),c.forEach(function(a,b,d){c[b]=a.replace(/ /g,"_").replace(/\./g,"").replace(/["'()]/g,"_")}),b=da(b),b=b.replace(/\./g,"");var d=document.createElement("div");d.className=b+" file",d.setAttribute("path",g[a].entry.fullPath),d.innerHTML='<div class="material-icons">insert_drive_file</div>'+g[a].entry.name,c.shift(),c.forEach(function(a,b,d){b===d.length-1?c[b]=a:c[b]=a+" ."+a+"ul"}),c="."+c.join(" ."),null===o.querySelector(c)&&(c=c.split(" "),c.forEach(function(a,b,c){var e=c.slice();if(e.splice(b+1,c.length-(b+1)),e=e.join(" "),null!==o.querySelector(e));else{var f=c,g=f.length-b;f.splice(b,g),f=f.join(" "),o.querySelector(f).appendChild(d)}}))}function ha(a){$(".loading-text").text("Loading "+a),$(".preload").show().velocity({opacity:"1"},{duration:200})}function ia(){$(".preload").stop().velocity({opacity:"0"},{duration:600,complete:function(){$(this).hide()}})}function ja(a){var b=a.createReader(),c=function(){b.readEntries(function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.isDirectory){var d=c.fullPath.split("/");d=d[d.length-2],h.push({name:c.name,path:c.fullPath,entry:c,parentDirectory:d}),fa(h.length-1),ja(c)}else g.push({entry:c}),ga(g.length-1)}})};c()}function la(a){$(".contextmenu").show().css({top:a.pageY+"px",left:a.pageX-20+"px",backgroundColor:x($(".sidebar").css("background-color"),-.2)}).stop().animate({opacity:"1"},200)}function ma(){$(".contextmenu").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function na(a){$(".folder-contextmenu").show().css({top:a.pageY+"px",left:a.pageX-20+"px",backgroundColor:x($(".sidebar").css("background-color"),-.2)}).stop().animate({opacity:"1"},200)}function oa(){$(".folder-contextmenu").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function xa(){$(".remove-dialogue .remove-dialogue-text").text("Are you sure you want to remove "+sa+"? This action cannot be undone."),$(".remove-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function ya(){$(".remove-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function za(){$(".folder-remove-dialogue .folder-remove-dialogue-text").text("Are you sure you want to remove "+wa+"? This will PERMANENTLY delete this folder from your computer."),$(".folder-remove-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Aa(){$(".folder-remove-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Ba(){$(".new-file-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Ca(){$(".new-file-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Da(){$(".new-folder-dialogue").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}function Ea(){$(".new-folder-dialogue").stop().animate({top:"60%",opacity:"0"},200,function(){$(this).hide()}),$(".bg").stop().animate({opacity:"0"},200,function(){$(this).hide()})}function Ga(a,b){for(var c=0;c<$(".tab").length;c++)if($(".tab").eq(c).attr("path")==b&&$(".tab").eq(c).find(".title").val()==a)return Fa=c,!0}function Ha(a){$(".active .title").val(a)}function Ia(){return $(".active .title").val()}function Ja(a){$(".active").attr("data",a)}function Ka(a){a?chrome.fileSystem.getWritableEntry(a,function(a){a.createWriter(function(d){var e=b[$(".active").index()].getDoc().getValue(),f=new Blob([e]),g=!1;d.onwriteend=function(a){if(!g)return g=!0,void this.truncate(f.size)},d.write(f);var h=a.name;Ha(h),c[$(".active").index()]=a,void 0!==$(".active").attr("data")&&$(".active").attr("data")!==!1&&""!==$(".active").attr("data")||Ja(h),$(".active .close").text("close"),$(".active .close").removeClass("edit"),$(".active").click(),Q===!0&&(R(m),Q=!1)})}):console.log("User cancelled saving.")}function La(){var a=Ia();chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,acceptsAllTypes:!0},Ka)}function Na(){var c,d,e,a=Ia();if(c=/.+\.([^.]+)$/.exec(a)){var f=CodeMirror.findModeByExtension(c[1]);f&&(d=f.mode,e=f.mime)}else if(/\//.test(a)){var f=CodeMirror.findModeByMIME(a);f&&(d=f.mode,e=a)}else d=e=a;d&&(b[$(".active").index()].setOption("mode",e),CodeMirror.autoLoadMode(b[$(".active").index()],d))}function Oa(){var a=$(".tabs").width(),b=$(".tab").length,c=a/b;c>200&&(c=200),$(".tab").css({width:c+"px"})}function Pa(){$(".started-content").stop().animate({top:"50%",opacity:"1"},800)}function Qa(a){e=[],d=[],f=[];for(var g=0;g<$(".tab").length;g++){var h=g,j=b[h].getValue(),k=$(".tab").eq(h).find(".material-icons").text(),l=h;d[h]=j,e[h]={name:$(".tab").eq(h).find(".title").val(),path:$(".tab").eq(h).attr("path"),dataAttr:$(".tab").eq(h).attr("data")},f[h]=k;var m=$(".active").index(),o=$(".sidebar").width();if(l===$(".tab").length-1){chrome.storage.local.set({data:d,tabs:e,state:f,inst:n,actv:m,sideBarWidth:o});var p=[];c.forEach(function(a,b){if(""===a||void 0===a);else{var c=chrome.fileSystem.retainEntry(a);p.push({index:b,entry:c})}});var q;q=void 0===aa?"":chrome.fileSystem.retainEntry(aa),chrome.storage.local.set({chosenFiles:p,chosenDirs:i,chosenDir:q})}}a&&a()}function Ra(a){$(".sidebar").width(a),$(".tabs").width($(window).width()-70-a),$(".workspace").width($(window).width()-a),$(".search-container").width($(window).width()-a)}function Sa(a){chrome.storage.local.get({data:"textArray",tabs:"tabArray",state:"editArray",inst:"installed",actv:"activeIndex",sideBarWidth:"sideWidth"},function(a){var d=a.data,e=a.tabs,f=a.state,g=a.inst,h=a.actv,k=a.sideBarWidth,l=Math.ceil(501*Math.random()+1800)*Math.log(8*JSON.stringify(d).length)/8;if("textArray"==d||"tabArray"==e||"editArray"==f||"activeIndex"==h||"installed"==g||"sideWidth"==k)j={theme:"material",font:"monospace",fontSize:"14px",tabSize:4,softWrap:!0},J(),y(j),Ra(250),setTimeout(function(){Ta(),Oa(),Va(),setTimeout(function(){Pa()},200)},1e3);else{g===!0&&$(".getting-started").remove();for(var m=0;m<d.length;m++){H(),b[m]=CodeMirror.fromTextArea(document.getElementById("textarea"+Number($(".tabs").children().last().attr("id").replace("tab",""))),t),b[m].getDoc().setValue(d[m]),b[m].getDoc().clearHistory(),F(m),$(".tab").eq(m).find(".title").val(e[m].name),$(".tab").eq(m).attr("data",e[m].dataAttr),$(".tab").eq(m).attr("path",e[m].path),""===$(".tab").eq(m).attr("data")&&(c[m]=""),"edit"==f[m]&&$(".tab").eq(m).find(".material-icons").addClass("edit"),$(".tab").eq(m).find(".material-icons").text(f[m]);var n=d.length-1;n===m&&(chrome.storage.local.get({chosenFiles:"key",chosenDirs:"rootDirs",chosenDir:"newProjectDir"},function(a){var b=a.chosenFiles,d=a.chosenDirs,e=a.chosenDir;"key"!=b&&b.forEach(function(a,b,d){chrome.fileSystem.isRestorable(a.entry,function(b){chrome.fileSystem.restoreEntry(a.entry,function(b){c[a.index]=b})})}),"newProjectDir"!=e&&chrome.fileSystem.isRestorable(e,function(a){chrome.fileSystem.restoreEntry(e,function(a){ba(a)})}),"rootDirs"!=d&&(o=document.createDocumentFragment(),d.forEach(function(a,b,c){chrome.fileSystem.isRestorable(a,function(b){chrome.fileSystem.restoreEntry(a,function(a){i.push(chrome.fileSystem.retainEntry(a)),I(a)})})}))}),Ra(k),setTimeout(function(){Ta(),$(".projects").append(o.children),ca(),$(".tab").eq(h).click(),A(),Oa(),Va()},l))}}})}function Ta(){if(launchData&&launchData.items)for(var a=0;a<launchData.items.length;a++){var b=[];b.push(launchData.items[a].entry),Y(b,!1)}}function Ua(){chrome.app.window.current().close()}function Va(){$(".preload").stop().velocity({opacity:"0"},{duration:800,complete:function(){$(this).hide()}}),$("body").removeClass("preload-body")}var a=["Please wait...a few bits tried to escape, but we caught them","Please wait...and dream of faster computers","Please wait...would you like fries with that?","Please wait...checking the gravitational constant in your locale","Please wait...go ahead -- hold your breath","Please wait...at least you're not on hold","Please wait...hum something loud while others stare","Please wait...you're not in Kansas any more","Please wait...the server is powered by a lemon and two electrodes","Please wait...we love you just the way you are","Please wait...while a larger software vendor in Seattle takes over the world","Please wait...we're testing your patience","Please wait...as if you had any other choice","Please wait...take a moment to sign up for our lovely prizes","Please wait...don't think of purple hippos","Please wait...follow the white rabbit","Please wait...why don't you order a sandwich?","Please wait...programming the flux capacitor","Please wait...the bits are breeding"];$(".loading-text").text(a[Math.round(Math.random()*(a.length-1))]),Sa(launchData),$(".windowBar").initializeWindowBar("#FFF"),$(".menu, .dropdown, .settings-container, .bg, .dialogue, .search-container, .contextmenu, .folder-contextmenu, .remove-dialogue, .folder-remove-dialogue, .new-file-dialogue, .new-folder-dialogue, .new-project-dialogue").hide();var j,k,l,m,n,o,p,q,r,s,b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=[],t={lineNumbers:!0,lineWrapping:!0,styleActiveLine:!1,matchBrackets:!0,autoCloseTags:!0,autoCloseBrackets:!0,tabSize:4,indentUnit:4,foldGutter:!0,dragDrop:!1,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],theme:"material",mode:"text/plain"};$(document).on("click",".selector-container",function(){var a=$(this).attr("class").split(" ");a=a[a.length-1];var b=a.replace("selector-","");u($(".dropdown-"+b)),"arrow_drop_down"==$(this).find(".material-icons").text()?$(this).find(".material-icons").text("arrow_drop_up"):$(this).find(".material-icons").text("arrow_drop_down")}),$(document).on("click",".dropdown .theme",function(){var a="theme",b=$(this).text();$(".active").attr("class","tab active active-"+b),C($(".selector-theme"),b),B(a,b),t.theme=b,$(".workspace, body").css("background-color",$(".CodeMirror").css("background-color")),$(".sidebar").css("background-color",x($(".CodeMirror").css("background-color"),-.2)),$(".add-newproject").css("background-color",x($(".active").css("box-shadow").replace(/^.*(rgba?\([^)]+\)).*$/,"$1"),-.4));var c=$(".CodeMirror").css("background-color");D(c),u($(this).parent()),v()}),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$(document).on("click",".dropdown .font-fam",function(){var a=$(this).text().capitalizeFirstLetter();C($(".selector-font"),$(this).text()),$(".CodeMirror").css("font-family",a),w(),u($(this).parent()),v()}),$(document).on("click",".dropdown .font-size",function(){var a=$(this).text();C($(".selector-font-size"),a),$(".CodeMirror").css("font-size",a),w(),u($(this).parent()),v()}),$(document).on("click",".dropdown .tab-size",function(){var a=Number($(this).text());C($(".selector-tab-size"),a),B("tabSize",a),t.tabSize=a,t.indentUnit=a,w(),u($(this).parent()),v()}),$(document).on("click",".dropdown .wrap",function(){var a=$(this).text();a="none"!=a,C($(".selector-wrap"),$(this).text()),B("lineWrapping",a),t.lineWrapping=a,w(),u($(this).parent()),v()}),$(".close-settings").click(function(){E()}),$(".bg").click(function(){$(".dialogue").is(":visible")&&P(),$(".remove-dialogue").is(":visible")&&ya(),$(".folder-remove-dialogue").is(":visible")&&Aa(),$(".new-file-dialogue").is(":visible")&&Ca(),$(".new-folder-dialogue").is(":visible")&&Ea(),$(".new-project-dialogue").is(":visible")&&_(),$(".settings-container").is(":visible")&&E(),b[$(".active").index()].focus()}),$(".tidy-up").click(function(){var c,a=b[$(".active").index()].getValue();c=$(".active").find(".title").val().indexOf(".html")>-1?html_beautify(a,{indent_size:t.tabSize}):$(".active").find(".title").val().indexOf(".css")>-1?css_beautify(a,{indent_size:t.tabSize}):$(".active").find(".title").val().indexOf(".js")>-1?js_beautify(a,{indent_size:t.tabSize}):js_beautify(a,{indent_size:t.tabSize}),b[$(".active").index()].setValue(c)}),$(".settings-button").click(function(){$(".dropdown").hide(),$(".settings-container").show().stop().animate({top:"50%",opacity:"1"},200),$(".bg").show().stop().animate({opacity:"0.6"},200)}),$(document).on("click",".CodeMirror",function(a){""===$(".active .title").val()&&$(".active .title").val("untitled.txt"),W()}),Array.prototype.move=function(a,b){if(b>=this.length)for(var c=b-this.length;c--+1;)this.push(void 0);this.splice(b,0,this.splice(a,1)[0])},$(".tabs").sortable({axis:"x",distance:20,tolerance:"pointer",revert:!0,start:function(a,b){a.stopImmediatePropagation(),a.stopPropagation(),$(this).attr("data-previndex",b.item.index()),$(this).addClass("noclick")},stop:function(a,d){a.stopImmediatePropagation(),a.stopPropagation();var e=d.item.index(),f=$(this).attr("data-previndex"),g=d.item.attr("id").replace("tab",""),h=$(".workspace > textarea").eq(e).attr("id").replace("textarea","");$(this).removeAttr("data-previndex"),f>e?($("#textarea"+g).insertBefore($("#textarea"+h)),$(".CodeMirror").eq(f).insertBefore($("#textarea"+h))):($(".CodeMirror").eq(f).insertAfter($(".CodeMirror").eq(e)),$("#textarea"+g).insertBefore($(".CodeMirror").eq(e))),b.move(f,e),c.move(f,e),w(),b[$(".active").index()].focus()}}).disableSelection();var K,L,M,N;$(document).on("click",".tab",function(a){if(a.stopPropagation(),$(this).hasClass("noclick"))$(this).removeClass("noClick");else{var d=$(this);0===d.find(".ink").length&&d.prepend('<div class="ink"></div>'),K=d.find(".ink"),K.removeClass("animate"),K.height()||K.width()||(L=Math.max(d.width(),d.height()),K.css({height:L,width:L})),M=a.pageX-d.offset().left-K.width()/2,N=a.pageY-d.offset().top-K.height()/2,K.css({top:N+"px",left:M+"px"}).addClass("animate"),$(".tab").removeClass("active"),$(".tab").removeClass("active-"+t.theme),$(this).addClass("active"),$(this).addClass("active-"+t.theme),$(".CodeMirror").hide(),$(".CodeMirror").eq($(".active").index()).show(),Na(),l=c[$(this).index()],b[$(".active").index()].refresh(),b[$(".active").index()].focus()}}),$(".buttons-dialogue .cancel").click(function(){P(),b[$(".active").index()].focus()}),$(".buttons-dialogue .no").click(function(){R(m),P()});var Q;$(".buttons-dialogue .yes").click(function(){Q=!0,$(".save").click(),P()}),$(document).on("click",".close",function(a){a.stopImmediatePropagation(),a.stopPropagation(),"edit"==$(this).text()?O($(this)):R($(this))}),$(document).on("change",".title",function(a){Na()}),$(document).on("keyup",".title",function(a){13==a.keyCode&&(""===$(this).val()&&$(this).val("untitled.txt"),b[$(".active").index()].focus())}),$(document).on("keydown",".title",function(a){65==a.keyCode&&a.ctrlKey&&a.target.select(),9==a.keyCode&&""===$(this).val()&&$(this).val("untitled.txt")});var U;$(".search-bar").on("keyup focus",function(){p=$(".search-bar").val(),r=b[$(".active").index()],s=getSearchState(r);var a=getSearchCursor(r,p,r.getCursor("from"));startSearch(r,s,p),0===U?(a.findNext(),r.scrollIntoView({from:a.from(),to:a.to()}),0===$(".cm-searching",".CodeMirror:eq("+$(".active").index()+") .CodeMirror-lines .CodeMirror-code div").length&&""!==p?$(this).css("box-shadow","inset 0px -1px 0px 0px rgba(239, 37, 37, 0.58)"):$(this).css("box-shadow","inset 0px -1px 0px 0px rgba(0, 0, 0, 0.1)"),U=1):U=0}),$(".find_next").click(function(){p=$(".search-bar").val(),r=b[$(".active").index()],s=getSearchState(r),startSearch(r,s,p),doSearch(r,!1)}),$(".find_prev").click(function(){p=$(".search-bar").val(),r=b[$(".active").index()],s=getSearchState(r),startSearch(r,s,p),doSearch(r,!0)}),$(".replace_all").click(function(){p=$(".search-bar").val(),q=$(".search-replace").val(),r=b[$(".active").index()],replaceAll(r,p,q)}),$(".replace").click(function(){q=$(".search-bar").val(),p=$(".search-replace").val(),r=b[$(".active").index()];var a=getSearchCursor(r,q,r.getCursor("from")),c=function(){var c,b=a.from();if((c=a.findNext())||(a=getSearchCursor(r,q),(c=a.findNext())&&(!b||a.from().line!=b.line||a.from().ch!=b.ch))){r.setSelection(a.from(),a.to()),r.scrollIntoView({from:a.from(),to:a.to()});var d=function(b){a.replace("string"==typeof q?p:p.replace(/\$(\d)/g,function(a,c){return b[c]}))};d(c)}};c()}),$(document).bind("keydown",function(a){(a.ctrlKey&&83==a.keyCode&&!a.shiftKey||a.metaKey&&83==a.keyCode&&!a.shiftKey)&&$(".save").click(),(a.ctrlKey&&a.shiftKey&&83==a.keyCode||a.metaKey&&a.shiftKey&&83==a.keyCode)&&$(".save-as").click(),(a.ctrlKey&&78==a.keyCode||a.metaKey&&78==a.keyCode)&&(a.preventDefault(),$(".new").click()),(a.ctrlKey&&79==a.keyCode||a.metaKey&&79==a.keyCode)&&$(".open").click(),(a.ctrlKey&&80==a.keyCode||a.metaKey&&80==a.keyCode)&&$(".settings-button").click(),(a.ctrlKey&&70==a.keyCode||a.metaKey&&70==a.keyCode)&&($(".search-container").is(":visible")&&""===window.getSelection()?T():S()),(a.ctrlKey&&87==a.keyCode||a.metaKey&&87==a.keyCode)&&(a.preventDefault(),$(".active .close").click()),27==a.keyCode&&T()}),$(".overflow-menu").click(function(){V()}),$(".menu-li").click(function(){W()}),$(document).on("click",".workspace, .tab, .tabs, .sidebar",function(){W()}),$(document).on("click",".title",function(a){a.stopPropagation(),W()}),$(".new").click(function(){H();var a=$(".active").index();b[a]=CodeMirror.fromTextArea(document.getElementById("textarea"+Number($(".tabs").children().last().attr("id").replace("tab",""))),t),void 0===j&&(j={theme:"material",font:"monospace",fontSize:"14px",tabSize:4,softWrap:!0}),y(j),setTimeout(function(){b[a].focus(),F(a)},1)}),$(".open").click(function(){chrome.fileSystem.chooseEntry({acceptsMultiple:!0},function(a){a||console.log("No Files Selected"),Y(a,!1)})}),$(".sidebar").resizable({handles:"e",maxWidth:400,resize:function(a,b){var c=b.size.width;$(".tabs").width($(window).width()-70-c),$(".workspace").width($(window).width()-c),$(".search-container").width($(window).width()-c),Oa()}}),$(".add-newproject").click(function(){Z(),$(".new-project-dialogue input").css("box-shadow","0px 1px 0px 0px #47bfa1"),$(".new-project-dialogue input").val(""),$(".new-project-dialogue input").focus()}),$(".new-project-cancel").click(function(){_(),b[$(".active").index()].focus()});var aa;$(".projects").scroll(function(){ma(),oa()}),$(".chooseDir").click(function(){chrome.fileSystem.chooseEntry({type:"openDirectory"},function(a){if(a)ba(a);else{var b="No Directory Chosen";ba(b)}})}),$(".new-project-create").click(function(){var a=$(this).parent().parent().find("input").val();""===a&&(a="untitled"),aa.getDirectory(a,{create:!0,exclusive:!0},function(a){i.push(chrome.fileSystem.retainEntry(a));var c=ea(a.fullPath,"/",2);h.push({name:a.name,path:a.fullPath,entry:a,parentDirectory:c});var d=document.createElement("div"),e=a.name;e=da(e),d.className=e+" folder",d.setAttribute("path",a.fullPath),d.innerHTML='<div class="material-icons">folder</div>'+a.name+'<ul class="'+e+'ul"></ul>',$(".projects").append(d),$(".projects").children().last().children().last().hide(),_(),b[$(".active").index()].focus()})}),$(document).on("keyup",".dialog-input",function(a){var b=$(this).val();""===b&&(b="untitled");var c=[];$(this).hasClass("new-project-input")?($(".projects").children().each(function(a){c.push($(this).clone().children().remove().end().text())}),13==a.keyCode&&$(".new-project-create").click()):va.children().last().children().each(function(a){c.push($(this).clone().children().remove().end().text())}),c.indexOf(b)>-1?$(this).css("box-shadow","0px 1px 0px 0px #d61f1f "):$(this).css("box-shadow","0px 1px 0px 0px #47bfa1")}),o=document.createDocumentFragment(),$(".open-dir").click(function(){chrome.fileSystem.chooseEntry({type:"openDirectory"},function(a){if(a){var b;if(0===i.length)i.push(chrome.fileSystem.retainEntry(a)),ha(a.name),o.innerHTML="",I(a),setTimeout(function(){$(".projects").append(o.children),ca(),ia()},1e3);else for(var c=0;c<i.length;c++)chrome.fileSystem.restoreEntry(i[c],function(c){c.fullPath==a.fullPath&&(b=!0)}),c===i.length-1&&(1==b||(i.push(chrome.fileSystem.retainEntry(a)),ha(a.name),o.innerHTML="",I(a),setTimeout(function(){$(".projects").append(o.children),ca(),ia()},1e3)))}else console.log("No Directory Selected")})}),$(document).on("click",".projects .folder",function(a){a.stopPropagation(),$(this).children("ul").is(":visible")?($(this).children("ul").hide(),$(this).children().closest(".material-icons").text("folder"),$(this).css("color","rgba(255,255,255,0.8)")):($(this).children("ul").show(),$(this).children().closest(".material-icons").text("folder_open"),$(this).css("color","#FFFFFF"))}),$(document).on("click",".projects ul",function(a){a.stopPropagation(),a.stopImmediatePropagation()});var ka;$(document).on("click",".projects .file",function(a){if(a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation(),a.handled!==!0){a.handled=!0;var b=[],d=$(this).clone().children().remove().end().text(),e=$(this).attr("path"),f=function(a){if(a.entry.name==d&&a.entry.fullPath==e)return a};ka=g.find(f),ka=ka.entry,Ga(d,e)===!0?$(".tab").eq(Fa).click():(b.push(ka),Y(b,!0))}ma()});var pa,qa,ra,sa,ta,ua,va,wa;$(document).on("contextmenu",".projects .file",function(a){a.stopPropagation(),a.preventDefault(),sa=$(this).clone().children().remove().end().text(),pa=sa,qa=$(this).attr("path"),ra=$(this),la(a)}),$(".contextmenu .remove").click(function(){xa(),ma()}),$(document).on("contextmenu",".projects .folder",function(a){a.stopPropagation(),a.preventDefault(),wa=$(this).clone().children().remove().end().text(),ta=wa,ua=$(this).attr("path"),va=$(this),na(a)}),$(document).on("keyup",".new-folder-dialogue input",function(a){a.stopPropagation(),13==a.keyCode&&$(".new-folder-create").click()}),$(document).on("keyup",".new-file-dialogue input",function(a){a.stopPropagation(),13==a.keyCode&&$(".new-file-create").click()}),$(".folder-contextmenu .folder-removefromproject").click(function(){var a=function(a){if(a.entry.name==ta&&a.entry.fullPath==ua)return a},c=h.find(a);c=c.entry;for(var d,e=0;e<i.length;e++)chrome.fileSystem.restoreEntry(i[e],function(a){a.fullPath==c.fullPath&&(i.splice(e,1),d=!0)});d&&(va.velocity("slideUp",{duration:200,complete:function(){$(this).remove()}}),b[$(".active").index()].focus())}),$(".folder-contextmenu .folder-addfolder").click(function(){Da(),oa(),$(".new-folder-dialogue input").css("box-shadow","0px 1px 0px 0px #47bfa1"),$(".new-folder-dialogue input").val(""),$(".new-folder-dialogue input").focus()}),$(".new-folder-create").click(function(){var a=$(this).parent().parent().find("input").val();""===a&&(a="untitled");var b=[];if(va.children().last().children().each(function(a){b.push($(this).clone().children().remove().end().text())}),b.indexOf(a)>-1)$(this).parent().parent().find("input").css("box-shadow","0px 1px 0px 0px #d61f1f ");else{var c=function(a){if(a.name==ta&&a.entry.fullPath==ua)return a},d=h.find(c);d=d.entry,d.getDirectory(a,{create:!0,exclusive:!0},function(a){var b=a.fullPath.split("/");b=b[b.length-2],h.push({name:a.name,path:a.fullPath,entry:a,parentDirectory:b});var c=a.name;c=da(c);var d=document.createElement("div");d.className=c+" folder",d.setAttribute("path",a.fullPath),d.innerHTML='<div class="material-icons">folder</div>'+a.name+'<ul class="'+c+'ul"></ul>',va.children().last().append(d),va.children().last().children().last().children().last().hide(),va.children().last().children().last().insertBefore(va.children().last().children().first()),Ea()})}}),$(".new-folder-cancel").click(function(){Ea(),b[$(".active").index()].focus()}),$(".folder-contextmenu .folder-remove").click(function(){za(),oa()}),$(".folder-remove-yes").click(function(){function a(a){if(a.name==ta&&a.entry.fullPath==ua)return a}var c=h.find(a);c=c.entry;for(var d=0;d<i.length;d++)chrome.fileSystem.restoreEntry(i[d],function(a){c.fullPath==a.fullPath&&i.splice(d,1)});c.removeRecursively(function(){va.velocity("slideUp",{duration:200,complete:function(){$(this).remove()}}),Aa(),b[$(".active").index()].focus()})}),$(".folder-remove-no").click(function(){Aa(),b[$(".active").index()].focus()}),$(".folder-addfile").click(function(){Ba(),ma(),$(".new-file-dialogue input").css("box-shadow","0px 1px 0px 0px #47bfa1"),$(".new-file-dialogue input").val(""),$(".new-file-dialogue input").focus()}),$(".new-file-cancel").click(function(){Ca(),b[$(".active").index()].focus()}),$(".new-file-create").click(function(){var a=$(this).parent().parent().find("input").val();""===a&&(a="untitled.txt");var b=[];if(va.children().last().children().each(function(a){
b.push($(this).clone().children().remove().end().text())}),b.indexOf(a)>-1)$(this).parent().parent().find("input").css("box-shadow","0px 1px 0px 0px #d61f1f ");else{var c=function(a){if(a.name==ta&&a.entry.fullPath==ua)return a},d=h.find(c);d=d.entry,d.getFile(a,{create:!0,exclusive:!0},function(a){var b=[];b.push(a),Y(b,!0),g.push({entry:a});var c=a.name;c=da(c),c=c.replace(/\./g,""),l=a;var d=document.createElement("div");d.className=c+" file",d.setAttribute("path",a.fullPath),d.innerHTML='<div class="material-icons">insert_drive_file</div>'+a.name,va.children().last().append(d),Ca()})}});var Fa;$(".remove-buttons .remove-yes").click(function(){function a(a){if(a.entry.name==pa&&a.entry.fullPath==qa)return a}ka=g.find(a),ka=ka.entry,Ga(pa,ka.fullPath)===!0?(R($(".tab").eq(Fa).find(".close")),ka.remove(function(){ra.remove(),ya(),b[$(".active").index()].focus()})):ka.remove(function(){ra.remove(),ya(),b[$(".active").index()].focus()})}),$(".remove-buttons .remove-no").click(function(){ya(),b[$(".active").index()].focus()}),$(document).on("mousedown",function(a){var b=a.target;$(b).parents().is(".contextmenu")&&$(b).parents().is(".folder-contextmenu")||(ma(),oa())}),$(".save").click(function(){if(l=c[$(".active").index()])Ka(l);else{var a=Ia();chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,acceptsAllTypes:!0},Ka)}}),$(".save-as").click(function(){La()});new DnDFileController("body",function(a){for(var b=[],c=0;c<a.items.length;c++)b.push(a.items[c].webkitGetAsEntry()),c===a.items.length-1&&Y(b,!1)});$(window).resize(function(){var a=$(".sidebar").width();$(".tabs").width($(window).width()-70-a),Oa(),$(".workspace").width($(window).width()-a),$(".search-container").width($(window).width()-a),w()}),$(".started-button").click(function(){$(".getting-started").stop().animate({top:"-100%",opacity:"0"},400,function(){$(this).remove()}),n=!0,Qa(),b[$(".active").index()].focus()}),chrome.runtime.onMessage.addListener(function(a,b,c){a.open&&Ta()}),$(document).delegate(".app-windowbar-close","click",function(){Qa(Ua)}),$(window).mouseleave(function(){Qa()}),$(document).delegate(".app-windowbar-minimize","click",function(){chrome.app.window.current().minimize()}),$(document).delegate(".app-windowbar-maximize","click",function(){b[$(".active").index()].focus(),$(".dialog-input").focus(),chrome.app.window.current().isMaximized()?chrome.app.window.current().restore():chrome.app.window.current().maximize()})});